<!DOCTYPE html>
<html>
  <head>
    <title>Galway City Search</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Bootstrap core CSS -->
    <link href="http://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.0.2/css/bootstrap.css" rel="stylesheet" media="screen">

    <script type='text/javascript' src='../knockout-3.4.0.js'></script>
      
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="http://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7/html5shiv.js"></script>
      <script src="http://cdnjs.cloudflare.com/ajax/libs/respond.js/1.3.0/respond.js"></script>
    <![endif]-->
    <style>
      html { height: 100% }
      body { height: 100%; background-color:#CCC }
      #map-outer {height: 440px; padding: 20px; border: 2px solid #CCC; margin-bottom: 20px; background-color:#FFF }
	  #mapDiv { height: 400px }
	  @media all and (max-width: 991px) {
		#map-outer  { height: 650px }
		}
    </style>
  </head>
  <body>
  <div class="container">
  <div class="row">
      <div id="map-outer" class="col-md-12">
          <div id="address" class="col-md-4">
            <h2>Galway City</h2>
            <address>
            <strong>What are you looking for?</strong><br>
                
            <form data-bind="submit: mySubmit">
                <input class="form-control" data-bind="value: myValue" />
                <button class="btn btn-warning pull-right" type="submit">Search</button>

            </form>
            <p>Enter a search term e.g. bar, restaurant, museum, hotel.</p>
           </address>
          </div>
        <div id="mapDiv" class="col-md-8"></div>
      </div><!-- /map-outer -->
  </div> <!-- /row -->

  <div class="row">
 
</div><!-- /row -->
</div><!-- /container -->
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="http://cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="http://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.0.2/js/bootstrap.min.js"></script>
<!--script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?libraries=places"></script-->
<script async defer src="https://maps.googleapis.com/maps/api/js?key= AIzaSyDGvqHsAa2HJkqMKTtpdvVoRKyQi-Acsfw&libraries=places&callback=initMap"
  type="text/javascript"></script>
  
    <script>
    
     /* This bit works - basic.... verified API key  
     var myMap;
      function initMap() {
        myMap = new google.maps.Map(document.getElementById('mapDiv'), {
          center: {lat: 53.27, lng: -9.053},
          zoom: 12
        });
      }*/

    // This example requires the Places library. Include the libraries=places
      // parameter when you first load the API. For example:
      // <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&libraries=places">

    var viewModel = {
        myValue: ko.observable("What are you looking for?"),
        mySubmit: function() {

            //alert("submitting: " + this.myValue());
            initMap(this.myValue());
        } //end mySubmit function

    }; //end viewModel
        
      var map;
      var infowindow;
      //var placeType = 'bar';

      function initMap(placeType) {
        var galway = {lat: 53.27, lng: -9.053};

        map = new google.maps.Map(document.getElementById('mapDiv'), {
          center: galway,
          zoom: 15
        });

        infowindow = new google.maps.InfoWindow();
        var service = new google.maps.places.PlacesService(map);
        service.nearbySearch({
          location: galway,
          radius: 500,
          type: [placeType]
        }, callback);
      }

      function callback(results, status) {
        if (status === google.maps.places.PlacesServiceStatus.OK) {
          for (var i = 0; i < results.length; i++) {
            createMarker(results[i]);
          }
        }
      }
  
        
      function createMarker(place) {
        var placeLoc = place.geometry.location;
        var marker = new google.maps.Marker({
          map: map,
          position: place.geometry.location
        });

        google.maps.event.addListener(marker, 'click', function() {
          infowindow.setContent(place.name);
          infowindow.open(map, this);
        });
      }

ko.applyBindings(viewModel);  
        
    </script>
  </body>
</html>